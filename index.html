
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLDK - Professional Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; transition: background 0.3s; }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); }
    </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- NAVIGATION -->
    <nav class="sticky top-0 z-50 glass border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center gap-3 cursor-pointer" onclick="router.navigate('shop')">
                    <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white font-black shadow-lg shadow-indigo-200">G</div>
                    <span id="nav-store-name" class="text-xl font-black tracking-tight">GLDK</span>
                </div>

                <div class="hidden md:flex flex-1 max-w-md mx-8">
                    <input type="text" id="global-search" oninput="shop.handleSearch(this.value)" placeholder="Search products..." class="w-full bg-slate-100 border-none rounded-2xl px-5 py-2.5 focus:ring-2 focus:ring-indigo-500/20 outline-none transition">
                </div>

                <div class="flex items-center gap-2">
                    <button onclick="router.navigate('shop')" class="text-sm font-bold text-slate-600 hover:text-indigo-600 px-3 py-2 rounded-xl transition">Shop</button>
                    <button onclick="router.navigate('admin-login')" class="text-sm font-bold text-slate-600 hover:text-indigo-600 px-3 py-2 rounded-xl transition">Admin</button>
                    <div class="h-6 w-px bg-slate-200 mx-1"></div>
                    <button onclick="router.navigate('cart')" class="relative p-2.5 text-slate-600 hover:bg-indigo-50 rounded-xl transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
                        <span id="cart-badge" class="absolute -top-1 -right-1 bg-indigo-600 text-white text-[10px] font-black w-5 h-5 rounded-full flex items-center justify-center border-2 border-white hidden">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- LOADING OVERLAY -->
    <div id="app-loader" class="fixed inset-0 z-[60] bg-white flex flex-col items-center justify-center space-y-4">
        <div class="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
        <p class="font-black text-indigo-600 animate-pulse tracking-widest uppercase text-xs">Syncing Store Data...</p>
    </div>

    <!-- APP ROOT -->
    <main id="app-root" class="max-w-7xl mx-auto px-4 py-10 sm:px-6 lg:px-8 min-h-screen"></main>

    <!-- FOOTER -->
    <footer class="bg-white border-t border-slate-200 py-16 text-center">
        <p class="text-slate-400 text-sm font-medium">© <span id="footer-year"></span> <span id="footer-store-name">GLDK</span>. Global Professional Commerce.</p>
    </footer>

    <!-- TEMPLATES -->
    <template id="tpl-shop">
        <div class="animate-fade-in space-y-12">
            <section id="shop-hero" class="relative h-[300px] rounded-[2.5rem] overflow-hidden bg-slate-900 shadow-xl hidden md:block">
                <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&q=80&w=1500" class="absolute inset-0 w-full h-full object-cover opacity-40">
                <div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-transparent to-transparent"></div>
                <div class="relative h-full flex flex-col justify-center px-12 max-w-xl">
                    <h2 class="text-4xl font-black text-white mb-4">Quality Across Devices</h2>
                    <p class="text-slate-300 text-lg mb-6">Your store inventory is synchronized in real-time via Google Sheets.</p>
                    <button onclick="document.getElementById('catalog').scrollIntoView({behavior:'smooth'})" class="bg-white text-slate-900 px-8 py-3.5 rounded-2xl font-black w-fit hover:bg-indigo-50 transition">Browse Now</button>
                </div>
            </section>

            <div id="catalog" class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                <div><h2 class="text-3xl font-black">Global Collection</h2><p id="product-count" class="text-slate-500 font-medium"></p></div>
                <div id="category-filters" class="flex gap-2 overflow-x-auto pb-2 w-full md:w-auto custom-scrollbar"></div>
            </div>

            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10"></div>
        </div>
    </template>

    <!-- CORE SCRIPT -->
    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        // ==========================================================
        // 1. PERMANENT SETTINGS - FILL YOUR IDs HERE
        // ==========================================================
        const HARDCODED_SETTINGS = {
            storeName: 'GLDK',
            adminPassword: 'admin',
            // GPay UPI ID
            gpayId: 'YOUR_UPI_ID@okaxis', 
            // Google Sheets Apps Script URL (Paste your Web App URL here)
            spreadsheetWebhook: 'https://script.google.com/macros/s/AKfycbxNQYagdzpJTbzIxashtoyeIcLapU-XMPVO34GFenQLpUj_lnO2JcNkBFhsCOZkCdDq/exec', 
            // EmailJS Credentials
            emailjsServiceId: 'service_xxxxxxx',
            emailjsTemplateId: 'template_xxxxxxx',
            emailjsPublicKey: 'YOUR_PUBLIC_KEY_HERE',
            apiKey: '' // Optional: Gemini API Key
        };

        // 2. DATA STATE
        const state = {
            view: 'shop',
            products: [], // Loaded from cloud
            cart: JSON.parse(localStorage.getItem('aura_cart')) || [],
            orders: JSON.parse(localStorage.getItem('aura_orders')) || [],
            settings: JSON.parse(localStorage.getItem('aura_settings')) || HARDCODED_SETTINGS,
            searchQuery: '',
            activeCategory: 'All',
            isAdmin: false,
            adminTab: 'products',
            checkoutPaymentMethod: 'online',
            showSetupHelp: false,
            testStatus: 'idle',
            isCloudSyncing: false
        };

        // Force Hardcoded Settings
        state.settings = { ...state.settings, ...HARDCODED_SETTINGS };

        const save = () => {
            localStorage.setItem('aura_cart', JSON.stringify(state.cart));
            localStorage.setItem('aura_orders', JSON.stringify(state.orders));
            localStorage.setItem('aura_settings', JSON.stringify(state.settings));
            updateUI();
        };

        // --- CLOUD SYNC HELPERS ---
        async function fetchProductsFromCloud() {
            if (!state.settings.spreadsheetWebhook || state.settings.spreadsheetWebhook.includes('PASTE_YOUR_GOOGLE_WEB_APP')) {
                // Fallback demo products
                state.products = [
                    { id: '1', name: 'Premium Leather Watch', category: 'Accessories', price: 149, stock: 12, image: 'https://picsum.photos/seed/watch/600/600', description: 'Timeless professional accessory.' },
                    { id: '2', name: 'Noise-Cancelling Headphones', category: 'Electronics', price: 299, stock: 8, image: 'https://picsum.photos/seed/audio/600/600', description: 'Studio quality sound.' }
                ];
                return;
            }
            try {
                const response = await fetch(state.settings.spreadsheetWebhook);
                const data = await response.json();
                if (Array.isArray(data)) {
                    state.products = data.map(p => ({
                        ...p,
                        price: parseFloat(p.price),
                        stock: parseInt(p.stock)
                    }));
                }
            } catch (err) { console.error("Cloud Fetch Error:", err); }
        }

        async function syncProductsToCloud() {
            if (!state.settings.spreadsheetWebhook || state.settings.spreadsheetWebhook.includes('PASTE_YOUR_GOOGLE_WEB_APP')) return;
            state.isCloudSyncing = true;
            updateUI();
            try {
                await fetch(state.settings.spreadsheetWebhook, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({
                        action: 'syncProducts',
                        products: state.products
                    })
                });
            } catch (err) { console.error("Cloud Sync Error:", err); }
            state.isCloudSyncing = false;
            updateUI();
        }

        // 3. ROUTING ENGINE
        const router = {
            navigate(view) {
                state.view = view;
                this.render();
            },
            render() {
                const root = document.getElementById('app-root');
                root.innerHTML = '';
                window.scrollTo(0, 0);

                if (state.view === 'shop') root.appendChild(shop.render());
                else if (state.view === 'cart') root.appendChild(cart.render());
                else if (state.view === 'admin-login') root.appendChild(admin.renderLogin());
                else if (state.view === 'admin') {
                    if (!state.isAdmin) this.navigate('admin-login');
                    else root.appendChild(admin.renderDashboard());
                }
                else if (state.view === 'checkout') root.appendChild(checkout.render());
                else if (state.view === 'order-success') root.appendChild(this.renderSuccess());
                
                updateUI();
            },
            renderSuccess() {
                const div = document.createElement('div');
                div.className = "max-w-2xl mx-auto text-center py-32 glass rounded-[3rem] border border-slate-200 shadow-xl animate-fade-in";
                div.innerHTML = `
                    <div class="mb-10 flex justify-center"><div class="bg-emerald-100 p-8 rounded-full text-emerald-600"><svg class="w-20 h-20" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7" /></svg></div></div>
                    <h1 class="text-5xl font-black mb-6">Order Placed!</h1>
                    <p class="text-xl text-slate-500 mb-12">Your order has been recorded in the cloud. Check your mail soon!</p>
                    <button onclick="router.navigate('shop')" class="bg-slate-900 text-white px-12 py-5 rounded-[2rem] font-black hover:bg-indigo-600 transition">Return to Store</button>
                `;
                return div;
            }
        };

        // 4. SHOP COMPONENT
        const shop = {
            handleSearch(q) {
                state.searchQuery = q;
                router.render();
            },
            addToCart(product) {
                const existing = state.cart.find(i => i.id === product.id);
                if (existing) existing.quantity++;
                else state.cart.push({ ...product, quantity: 1 });
                save();
            },
            render() {
                const temp = document.getElementById('tpl-shop').content.cloneNode(true);
                const grid = temp.getElementById('product-grid');
                const filters = temp.getElementById('category-filters');
                
                const categories = ['All', ...new Set(state.products.map(p => p.category))];
                categories.forEach(cat => {
                    const btn = document.createElement('button');
                    btn.className = `px-5 py-2.5 rounded-2xl text-sm font-bold whitespace-nowrap transition border ${state.activeCategory === cat ? 'bg-indigo-600 text-white border-indigo-600 shadow-lg' : 'bg-white text-slate-600 border-slate-200'}`;
                    btn.innerText = cat;
                    btn.onclick = () => { state.activeCategory = cat; router.render(); };
                    filters.appendChild(btn);
                });

                const filtered = state.products.filter(p => {
                    const matchesCat = state.activeCategory === 'All' || p.category === state.activeCategory;
                    const matchesSearch = p.name.toLowerCase().includes(state.searchQuery.toLowerCase());
                    return matchesCat && matchesSearch;
                });

                temp.getElementById('product-count').innerText = `${filtered.length} products found`;

                filtered.forEach(p => {
                    const card = document.createElement('div');
                    card.className = "bg-white rounded-[2rem] border border-slate-200 overflow-hidden hover:shadow-2xl transition-all duration-500 group";
                    card.innerHTML = `
                        <div class="aspect-square overflow-hidden bg-slate-100">
                            <img src="${p.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 ease-out">
                        </div>
                        <div class="p-8 space-y-4">
                            <div><p class="text-[10px] font-black text-indigo-600 uppercase tracking-widest mb-1">${p.category}</p><h3 class="text-xl font-black">${p.name}</h3></div>
                            <p class="text-sm text-slate-500 line-clamp-2">${p.description}</p>
                            <div class="flex justify-between items-center pt-4 border-t border-slate-50">
                                <span class="text-2xl font-black">$${p.price}</span>
                                <button class="add-btn bg-slate-900 text-white px-6 py-3 rounded-2xl font-black hover:bg-indigo-600 transition shadow-lg">Add to Cart</button>
                            </div>
                        </div>
                    `;
                    card.querySelector('.add-btn').onclick = () => shop.addToCart(p);
                    grid.appendChild(card);
                });

                return temp;
            }
        };

        // 5. CART COMPONENT
        const cart = {
            render() {
                const container = document.createElement('div');
                container.className = "animate-fade-in";
                
                if (state.cart.length === 0) {
                    container.innerHTML = `<div class="text-center py-40">
                        <div class="bg-indigo-50 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 text-indigo-200">
                            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
                        </div>
                        <h2 class="text-3xl font-black mb-4">Cart is Empty</h2>
                        <button onclick="router.navigate('shop')" class="text-indigo-600 font-black">Browse Products &rarr;</button>
                    </div>`;
                    return container;
                }

                const total = state.cart.reduce((s, i) => s + (i.price * i.quantity), 0);
                container.innerHTML = `
                    <h2 class="text-4xl font-black mb-10 tracking-tight">Shopping Bag</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                        <div class="lg:col-span-2 space-y-4" id="cart-items"></div>
                        <div class="bg-white p-8 rounded-[2.5rem] border h-fit shadow-xl space-y-6 sticky top-24">
                            <h3 class="text-xl font-black">Summary</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between text-slate-500"><span>Subtotal</span><span>$${total}</span></div>
                                <div class="flex justify-between text-emerald-500 font-bold"><span>Shipping</span><span>FREE</span></div>
                                <div class="pt-4 border-t flex justify-between items-center"><span class="font-black text-xl">Total</span><span class="text-3xl font-black text-indigo-600">$${total}</span></div>
                            </div>
                            <button onclick="router.navigate('checkout')" class="w-full bg-slate-900 text-white py-5 rounded-2xl font-black hover:bg-indigo-600 transition shadow-lg">Proceed to Checkout</button>
                        </div>
                    </div>
                `;

                const list = container.querySelector('#cart-items');
                state.cart.forEach(item => {
                    const row = document.createElement('div');
                    row.className = "bg-white p-6 rounded-3xl border flex gap-6 items-center hover:border-indigo-100 transition shadow-sm";
                    row.innerHTML = `
                        <img src="${item.image}" class="w-24 h-24 rounded-2xl object-cover border">
                        <div class="flex-1">
                            <h4 class="font-black text-lg">${item.name}</h4>
                            <p class="text-sm text-slate-400">$${item.price} each</p>
                        </div>
                        <div class="flex items-center gap-4 bg-slate-50 p-2 rounded-xl border">
                            <button class="qty-down font-black px-2 text-slate-400 hover:text-indigo-600">-</button>
                            <span class="font-black w-4 text-center">${item.quantity}</span>
                            <button class="qty-up font-black px-2 text-slate-400 hover:text-indigo-600">+</button>
                        </div>
                        <p class="font-black text-xl w-24 text-right">$${item.price * item.quantity}</p>
                    `;
                    row.querySelector('.qty-up').onclick = () => { item.quantity++; save(); router.render(); };
                    row.querySelector('.qty-down').onclick = () => { 
                        item.quantity--; 
                        if (item.quantity <= 0) state.cart = state.cart.filter(i => i.id !== item.id);
                        save(); router.render(); 
                    };
                    list.appendChild(row);
                });

                return container;
            }
        };

        // 6. CHECKOUT COMPONENT
        const checkout = {
            render() {
                const total = state.cart.reduce((s, i) => s + (i.price * i.quantity), 0);
                const div = document.createElement('div');
                div.className = "animate-fade-in max-w-5xl mx-auto";
                div.innerHTML = `
                    <div class="flex items-center gap-4 mb-10">
                        <button onclick="router.navigate('cart')" class="p-3 bg-white border rounded-xl hover:bg-slate-50 transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button>
                        <h2 class="text-4xl font-black tracking-tight">Final Step</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                        <form id="checkout-form" class="space-y-6">
                            <div class="bg-white p-8 rounded-[2.5rem] border shadow-sm space-y-6">
                                <h3 class="text-xl font-black mb-4">Shipping Information</h3>
                                <input type="text" placeholder="Full Name" required class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500/20 transition">
                                <input type="email" placeholder="Email Address" required class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500/20 transition">
                                <input type="tel" placeholder="Phone Number" required class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500/20 transition">
                                <textarea placeholder="Full Shipping Address" required class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500/20 transition" rows="3"></textarea>
                                
                                <div class="pt-4">
                                    <label class="block text-xs font-black text-slate-400 mb-3 uppercase tracking-widest">Payment Method</label>
                                    <div class="grid grid-cols-2 gap-3">
                                        <button type="button" onclick="window.setPaymentMethod('online')" class="p-4 border rounded-2xl font-bold transition ${state.checkoutPaymentMethod === 'online' ? 'border-indigo-600 bg-indigo-50' : 'bg-slate-50 border-slate-200'}">GPay (Online)</button>
                                        <button type="button" onclick="window.setPaymentMethod('store')" class="p-4 border rounded-2xl font-bold transition ${state.checkoutPaymentMethod === 'store' ? 'border-indigo-600 bg-indigo-50' : 'bg-slate-50 border-slate-200'}">Pay at Store</button>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" id="place-order-btn" class="w-full bg-slate-900 text-white py-5 rounded-2xl font-black text-lg shadow-xl shadow-slate-200 hover:bg-indigo-600 transition">Place Order ($${total})</button>
                        </form>
                        <div class="${state.checkoutPaymentMethod === 'online' ? 'block' : 'hidden'} bg-indigo-600 rounded-[2.5rem] p-10 text-white text-center flex flex-col items-center justify-center shadow-2xl">
                            <h3 class="text-2xl font-black mb-8">Scan & Pay</h3>
                            <div class="bg-white p-4 rounded-3xl mb-8 shadow-inner">
                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=upi://pay?pa=${state.settings.gpayId}&am=${total}" class="w-56 h-56">
                            </div>
                            <div class="space-y-2">
                                <p class="text-indigo-200 font-bold uppercase tracking-widest text-xs">Merchant ID</p>
                                <p class="font-mono text-xl font-black bg-indigo-500/30 px-6 py-2 rounded-xl border border-indigo-400/30">${state.settings.gpayId}</p>
                            </div>
                        </div>
                    </div>
                `;
                div.querySelector('form').onsubmit = async (e) => {
                    e.preventDefault();
                    const btn = document.getElementById('place-order-btn');
                    btn.disabled = true;
                    btn.innerText = "Processing Cloud Sync...";

                    const order = {
                        id: 'ORD-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
                        customerName: e.target[0].value,
                        customerEmail: e.target[1].value,
                        customerPhone: e.target[2].value,
                        address: e.target[3].value,
                        paymentMethod: state.checkoutPaymentMethod,
                        total,
                        items: [...state.cart],
                        createdAt: new Date().toISOString()
                    };

                    state.orders.unshift(order);

                    // 1. Spreadsheet Webhook (Primary Order Storage)
                    if (state.settings.spreadsheetWebhook && !state.settings.spreadsheetWebhook.includes('PASTE_YOUR_GOOGLE_WEB_APP')) {
                        try { 
                            await fetch(state.settings.spreadsheetWebhook, { 
                                method: 'POST', 
                                mode: 'no-cors', 
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ action: 'addOrder', ...order }) 
                            }); 
                        } catch(err){ console.error("Sheet Order Error:", err); }
                    }

                    // 2. EmailJS Integration
                    if (state.settings.emailjsServiceId && state.settings.emailjsPublicKey && !state.settings.emailjsPublicKey.includes('YOUR_PUBLIC_KEY')) {
                        try {
                            emailjs.init(state.settings.emailjsPublicKey);
                            const itemsString = order.items.map(i => `${i.quantity}x ${i.name}`).join(', ');
                            await emailjs.send(state.settings.emailjsServiceId, state.settings.emailjsTemplateId, {
                                order_id: order.id,
                                customer_name: order.customerName,
                                customer_email: order.customerEmail,
                                customer_phone: order.customerPhone,
                                address: order.address,
                                total_price: `$${order.total}`,
                                items: itemsString,
                                payment_method: order.paymentMethod
                            });
                        } catch(err) { console.error("Email Error:", err); }
                    }
                    
                    state.cart = [];
                    save();
                    router.navigate('order-success');
                };
                return div;
            }
        };

        // 7. ADMIN COMPONENTS
        const admin = {
            renderLogin() {
                const div = document.createElement('div');
                div.className = "max-w-md mx-auto py-20 animate-fade-in";
                div.innerHTML = `
                    <div class="bg-white p-12 rounded-[3rem] border shadow-2xl text-center space-y-8">
                        <div class="w-20 h-20 bg-indigo-50 rounded-3xl flex items-center justify-center mx-auto text-indigo-600"><svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg></div>
                        <h2 class="text-3xl font-black tracking-tight">Admin Console</h2>
                        <div class="space-y-4">
                            <input type="password" id="admin-pass" placeholder="Password" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500/20 transition text-center">
                            <button onclick="admin.login()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black hover:bg-indigo-600 transition shadow-lg">Enter Dashboard</button>
                        </div>
                    </div>
                `;
                return div;
            },
            login() {
                const pass = document.getElementById('admin-pass').value;
                if (pass === state.settings.adminPassword) { state.isAdmin = true; router.navigate('admin'); }
                else alert('Access Denied');
            },
            logout() { state.isAdmin = false; router.navigate('shop'); },
            setTab(t) { state.adminTab = t; router.render(); },
            toggleSetupHelp() { state.showSetupHelp = !state.showSetupHelp; router.render(); },
            async testWebhook() {
                if (!state.settings.spreadsheetWebhook || state.settings.spreadsheetWebhook.includes('PASTE_YOUR_GOOGLE_WEB_APP')) return alert("Enter real Webhook URL first!");
                state.testStatus = 'loading'; router.render();
                try {
                    await fetch(state.settings.spreadsheetWebhook, { method: 'POST', mode: 'no-cors', body: JSON.stringify({id: 'TEST'}) });
                    state.testStatus = 'success';
                } catch(e) { state.testStatus = 'error'; }
                router.render();
                setTimeout(() => { state.testStatus = 'idle'; router.render(); }, 3000);
            },
            renderDashboard() {
                const div = document.createElement('div');
                div.className = "animate-fade-in space-y-10 pb-20";
                div.innerHTML = `
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 border-b pb-10">
                        <div>
                            <h2 class="text-4xl font-black tracking-tight">Dashboard</h2>
                            <p class="text-slate-500 font-medium">Cloud status: ${state.isCloudSyncing ? '<span class="text-indigo-600 animate-pulse">Syncing...</span>' : '<span class="text-emerald-500">Global</span>'}</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="bg-slate-200/50 p-1 rounded-2xl border flex">
                                <button onclick="admin.setTab('products')" class="px-6 py-2 rounded-xl text-sm font-black transition ${state.adminTab === 'products' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-500 hover:text-slate-900'}">Inventory</button>
                                <button onclick="admin.setTab('orders')" class="px-6 py-2 rounded-xl text-sm font-black transition ${state.adminTab === 'orders' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-500 hover:text-slate-900'}">Orders</button>
                                <button onclick="admin.setTab('settings')" class="px-6 py-2 rounded-xl text-sm font-black transition ${state.adminTab === 'settings' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-500 hover:text-slate-900'}">Config</button>
                            </div>
                            <button onclick="admin.logout()" class="px-5 py-2 text-sm font-black text-red-500 hover:bg-red-50 rounded-xl transition">Logout</button>
                        </div>
                    </div>
                    <div id="admin-content"></div>
                `;

                const content = div.querySelector('#admin-content');
                if (state.adminTab === 'products') {
                    content.innerHTML = `
                        <div class="flex justify-between items-center mb-6"><h3 class="text-2xl font-black">Global Cloud Inventory</h3><button onclick="admin.addProduct()" class="bg-indigo-600 text-white px-8 py-3 rounded-2xl font-black shadow-lg shadow-indigo-100">+ New Product</button></div>
                        <div class="bg-white rounded-3xl border overflow-hidden shadow-sm">
                            <table class="w-full text-left">
                                <thead class="bg-slate-50 border-b"><tr><th class="p-6 text-xs font-black uppercase tracking-widest text-slate-400">Product</th><th class="p-6 text-xs font-black uppercase tracking-widest text-slate-400">Category</th><th class="p-6 text-xs font-black uppercase tracking-widest text-slate-400 text-right">Action</th></tr></thead>
                                <tbody>${state.products.map(p => `
                                    <tr class="border-b last:border-0 hover:bg-slate-50/50 transition">
                                        <td class="p-6 font-bold flex items-center gap-4"><img src="${p.image}" class="w-10 h-10 rounded-lg object-cover">${p.name}</td>
                                        <td class="p-6 text-slate-500 text-sm font-medium">${p.category}</td>
                                        <td class="p-6 text-right"><button onclick="admin.deleteProduct('${p.id}')" class="text-red-500 font-black text-xs uppercase tracking-tighter">Delete</button></td>
                                    </tr>
                                `).join('')}</tbody>
                            </table>
                        </div>
                    `;
                } else if (state.adminTab === 'orders') {
                    content.innerHTML = `
                        <h3 class="text-2xl font-black mb-6">Global Sales (Live)</h3>
                        <div class="grid gap-4">${state.orders.map(o => `
                            <div class="bg-white p-8 rounded-[2rem] border flex justify-between items-center shadow-sm">
                                <div><p class="font-black text-lg text-indigo-600">${o.customerName}</p><p class="text-xs text-slate-400 font-bold">${o.id} • ${new Date(o.createdAt).toLocaleDateString()}</p></div>
                                <div class="text-right"><p class="font-black text-2xl">$${o.total}</p><p class="text-[10px] font-black uppercase text-emerald-500">${o.paymentMethod}</p></div>
                            </div>
                        `).join('')}</div>
                    `;
                } else if (state.adminTab === 'settings') {
                    const fullCloudScript = `function doGet(e) {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheetByName("Products") || ss.insertSheet("Products");
  var data = sheet.getDataRange().getValues();
  var products = [];
  if (data.length > 1) {
    var headers = data[0];
    for (var i = 1; i < data.length; i++) {
      var p = {};
      headers.forEach((h, j) => p[h] = data[i][j]);
      products.push(p);
    }
  }
  return ContentService.createTextOutput(JSON.stringify(products)).setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  var data = JSON.parse(e.postData.contents);
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  if (data.action === "addOrder") {
    var sheet = ss.getSheetByName("Orders") || ss.insertSheet("Orders");
    if (sheet.getLastRow() === 0) {
      sheet.appendRow(["Date", "Order ID", "Customer", "Email", "Phone", "Address", "Items", "Total", "Payment"]);
    }
    var items = data.items.map(function(i) { return i.quantity + "x " + i.name; }).join(", ");
    sheet.appendRow([new Date(), data.id, data.customerName, data.customerEmail, data.customerPhone, data.address, items, "$" + data.total, data.paymentMethod]);
  } else if (data.action === "syncProducts") {
    var sheet = ss.getSheetByName("Products") || ss.insertSheet("Products");
    sheet.clear();
    if (data.products.length > 0) {
      var headers = Object.keys(data.products[0]);
      sheet.appendRow(headers);
      data.products.forEach(p => sheet.appendRow(headers.map(h => p[h])));
    }
  }
  return ContentService.createTextOutput("Success").setMimeType(ContentService.MimeType.TEXT);
}`;

                    content.innerHTML = `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                            <div class="bg-white p-10 rounded-[2.5rem] border shadow-sm space-y-8">
                                <h3 class="text-2xl font-black">Cloud Hub</h3>
                                <div><label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">Store Branding</label><input value="${state.settings.storeName}" oninput="state.settings.storeName=this.value;window.save()" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none"></div>
                                <div><label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">UPI ID</label><input value="${state.settings.gpayId}" oninput="state.settings.gpayId=this.value;window.save()" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none"></div>
                                <div><label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">Apps Script Webhook URL</label><input value="${state.settings.spreadsheetWebhook}" oninput="state.settings.spreadsheetWebhook=this.value;window.save()" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none"></div>
                                <div class="flex gap-2">
                                    <button onclick="admin.toggleSetupHelp()" class="text-xs font-black uppercase text-indigo-600 bg-indigo-50 px-4 py-2 rounded-xl">Advanced Sync Code</button>
                                </div>
                                <div class="${state.showSetupHelp ? 'block' : 'hidden'} bg-slate-900 p-6 rounded-3xl space-y-4">
                                    <p class="text-white text-[10px] font-black uppercase">PASTE THIS CODE INTO GOOGLE APPS SCRIPT:</p>
                                    <pre class="bg-slate-800 p-4 rounded-xl text-[10px] text-indigo-300 font-mono overflow-x-auto select-all">${fullCloudScript}</pre>
                                </div>
                            </div>

                            <div class="bg-white p-10 rounded-[2.5rem] border shadow-sm space-y-8">
                                <h3 class="text-2xl font-black">EmailJS</h3>
                                <div><label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">Service ID</label><input value="${state.settings.emailjsServiceId}" oninput="state.settings.emailjsServiceId=this.value;window.save()" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none"></div>
                                <div><label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">Template ID</label><input value="${state.settings.emailjsTemplateId}" oninput="state.settings.emailjsTemplateId=this.value;window.save()" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none"></div>
                                <div><label class="block text-xs font-black text-slate-400 mb-2 uppercase tracking-widest">Public Key</label><input value="${state.settings.emailjsPublicKey}" oninput="state.settings.emailjsPublicKey=this.value;window.save()" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none"></div>
                            </div>
                        </div>
                    `;
                }
                return div;
            },
            async addProduct() {
                const name = prompt('Product Name:');
                if (!name) return;
                const price = parseFloat(prompt('Price ($):') || '0');
                const cat = prompt('Category:') || 'General';
                
                let desc = "Professional cloud-synced item.";
                if (state.settings.apiKey) {
                    try {
                        const ai = new GoogleGenAI({ apiKey: state.settings.apiKey });
                        const result = await ai.models.generateContent({
                            model: 'gemini-3-flash-preview',
                            contents: `Generate a 1-sentence sales pitch for: "${name}" in category "${cat}".`
                        });
                        desc = result.text.trim();
                    } catch(e) { console.error("AI Error:", e); }
                }

                state.products.unshift({
                    id: Date.now().toString(),
                    name,
                    price,
                    category: cat,
                    stock: 10,
                    image: `https://picsum.photos/seed/${Math.random()}/600/600`,
                    description: desc
                });
                
                await syncProductsToCloud();
                router.render();
            },
            async deleteProduct(id) {
                if (confirm('Delete from Cloud? This will update all devices.')) {
                    state.products = state.products.filter(p => p.id !== id);
                    await syncProductsToCloud();
                    router.render();
                }
            }
        };

        // 8. INITIALIZE APP
        function updateUI() {
            const count = state.cart.reduce((s, i) => s + i.quantity, 0);
            const badge = document.getElementById('cart-badge');
            if (count > 0) { badge.innerText = count; badge.classList.remove('hidden'); }
            else badge.classList.add('hidden');
            
            const storeName = state.settings.storeName || 'GLDK';
            document.getElementById('nav-store-name').innerText = storeName;
            document.getElementById('footer-store-name').innerText = storeName;
            document.title = storeName + " - Sync Commerce";
            document.getElementById('footer-year').innerText = new Date().getFullYear();
        }

        // Global exposing
        window.router = router;
        window.shop = shop;
        window.admin = admin;
        window.state = state;
        window.save = save;
        window.setPaymentMethod = (method) => {
            state.checkoutPaymentMethod = method;
            router.render();
        };

        // STARTUP LOGIC: Fetch from cloud before showing shop
        (async () => {
            await fetchProductsFromCloud();
            document.getElementById('app-loader').classList.add('hidden');
            router.render();
        })();

    </script>
</body>
</html>
